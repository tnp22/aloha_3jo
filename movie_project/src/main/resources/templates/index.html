<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout}">
<html lang="en">
<head>
    <title>Movie Website</title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body layout:fragment="content">

    <section class="banner">
        <div id="movie-slide" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#movie-slide" data-bs-slide-to="0" class="active" aria-current="true"></button>
              <button type="button" data-bs-target="#movie-slide" data-bs-slide-to="1"></button>
              <button type="button" data-bs-target="#movie-slide" data-bs-slide-to="2"></button>
            </div>
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img th:src="@{/image(id='C:/upload/banner1.png')}">
              </div>
              <div class="carousel-item">
                <img th:src="@{/image(id='C:/upload/banner2.png')}">
              </div>
              <div class="carousel-item">
                <img th:src="@{/image(id='C:/upload/banner3.png')}">
              </div>
            </div>
        </div>
    </section>

    <section class="container mb-5">
        <div class="nav nav-tabs" style="margin-bottom: 20px; display: flex; position:relative">
            <a class="nav-link active" data-bs-toggle="tab" data-bs-target="#movie-chart" type="button">영화 차트</a>
            <h3 style="opacity: 50%;">│</h3>
            <a class="nav-link" data-bs-toggle="tab" data-bs-target="#upcome-chart" type="button">상영 예정작</a>
            <a href="/movie/movieChart" class="btn all-button d-flex align-items-center" style="position: absolute; right: 0;">
                <span>전체보기</span>
                <i class="bi bi-chevron-right"></i>
            </a>
        </div>
        <div class="tab-content">
            <div class="tab-pane show active" id="movie-chart">
                <button class="slider-btn prev-btn hidden"><i class="bi bi-chevron-left"></i></button>
                <div class="slider-wrapper">
                    <div class="row movie-chart slider" id="movie-slider">
                        <th:block th:each="movie : ${moviePageInfo.list}">
                            <div class="col">
                                <div class="image-container">
                                    <img th:src="|/img?id=${movie.files.id}|">
                                    <div class="image-overlay">
                                        <a th:href="|/movie/movieInfo?id=${movie.id}|" class="info-btn">상세보기</a>
                                        <br>
                                        <br>
                                        <a th:href="|/m/t?id=${movie.id}|" class="reserve-btn">예매하기</a>
                                    </div>
                                </div>
                                <p class="text-center mt-2" th:text="${movie.title}"></p>
                            </div>
                        </th:block>
                    </div>
                </div>
                <button class="slider-btn next-btn"><i class="bi bi-chevron-right"></i></button>
            </div>

            <div class="tab-pane" id="upcome-chart">
                <button class="slider-btn prev-btn hidden"><i class="bi bi-chevron-left"></i></button>
                <div class="slider-wrapper">
                    <div class="row movie-chart slider" id="upcome-slider">
                        <th:block th:each="expect : ${expectPageInfo.list}">
                            <div class="col">
                                <div class="image-container">
                                    <img th:src="|/img?id=${expect.files.id}|">
                                    <div class="image-overlay">
                                        <a th:href="|/movie/movieInfo?id=${expect.id}|" class="info-btn">상세보기</a>
                                        <br>
                                        <br>
                                        <a th:href="|/reserve?id=${expect.id}|" class="reserve-btn">예매하기</a>
                                    </div>
                                </div>
                                <p class="text-center mt-2" th:text="${expect.title}"></p>
                            </div>
                        </th:block>
                    </div>
                </div>
                <button class="slider-btn next-btn"><i class="bi bi-chevron-right"></i></button>
            </div>
        </div>
    </section>


    <section class="container mb-5">
        <h2 class="h4 mb-4">무비 스낵</h2>
        <div class="snack-list">
            <div class="snack">
                <img th:src="@{/image(id='C:/upload/snack1.png')}">
                <div>
                    <span>보라</span> 팝콘 더블 세트
                    <h6>11,000원</h6>
                </div>
            </div>
            <div class="snack">
                <img th:src="@{/image(id='C:/upload/snack2.png')}">
                <div>
                    <span>보라</span> 칠리치즈 핫도그
                    <h6>5,500원</h6>
                </div>
            </div>
        </div>
        <div class="snack-list">
            <div class="snack">
                <img th:src="@{/image(id='C:/upload/snack3.png')}">
                <div>
                    <span>보라</span> 커플 세트
                    <h6>9,500원</h6>
                </div>
            </div>
            <div class="snack">
                <img th:src="@{/image(id='C:/upload/snack4.png')}">
                <div>
                    <span>보라</span> 플레인 핫도그
                    <h6>5,000원</h6>
                </div>
            </div>
        </div>
        <div class="snack-list">
            <div class="snack">
                <img th:src="@{/image(id='C:/upload/snack5.png')}">
                <div>
                    <span>보라</span> 나쵸칩
                    <h6>4,500원</h6>
                </div>
            </div>
            <div class="snack">
                <img th:src="@{/image(id='C:/upload/snack6.png')}">
                <div>
                    <span>보라</span> 아이스 아메리카노
                    <h6>3,500원</h6>
                </div>
            </div>
        </div>
    </section>

    <section class="container mb-5">
        <div class="row g-6">
          <div class="col-md-7">
            <div class="box">
              <h5 class="mb-3">공지사항</h5>
              <ul class="list-unstyled">
                <th:block th:each="notice : ${noticeList}">
                    <li>
                    <a href="|/notice?id=${notice.id}|" th:text="${notice.title}"></a>
                    <span class="date" th:text="${ #dates.format( notice.regDate, 'yyyy-MM-dd' ) }"></span>
                    </li>
                </th:block>
              </ul>
              <hr>
              <h5>고객센터</h5>
              <h6>전화번호 : 010-8753-8710</h6>
              <h6>고객센터 운영시간 : 평일 (09:00 - 18:00) / 주말 및 공휴일 (09:00 - 14:00)</h6>
            </div>
          </div>
          <div class="col-md-4 image-box">
            <img th:src="@{/image(id='C:/upload/ad.png')}" style="width: 525px; height: 266px;">
          </div>
        </div>
    </section>

    <script>
        $(document).ready(function () {
            // 슬라이드 상태 추적 객체
            var sliderStates = {
                "movie-slider": 0,  // 영화 슬라이더의 현재 슬라이드
                "upcome-slider": 0  // 예정 슬라이더의 현재 슬라이드
            };

            // 슬라이드 초기화 함수
            function initSlider(sliderId, prevBtn, nextBtn) {
                var itemWidth = $("#" + sliderId + " .col").outerWidth(true); // 슬라이드 항목의 너비
                var visibleItems = 6; // 한 번에 보이는 슬라이드 개수
                var totalItems = $("#" + sliderId + " .col").length; // 슬라이드 항목 총 개수
                var slideCount = Math.ceil(totalItems / visibleItems); // 총 슬라이드 횟수

                // 현재 슬라이드 상태 가져오기
                var currentSlide = sliderStates[sliderId];

                // 버튼 상태 업데이트 함수
                function updateButtons() {
                    if (currentSlide === 0) {
                        $(prevBtn).addClass("hidden"); // 첫 슬라이드일 때 왼쪽 버튼 숨기기
                    } else {
                        $(prevBtn).removeClass("hidden");
                    }

                    if (currentSlide === slideCount - 1) {
                        $(nextBtn).addClass("hidden"); // 마지막 슬라이드일 때 오른쪽 버튼 숨기기
                    } else {
                        $(nextBtn).removeClass("hidden");
                    }
                }

                // 슬라이드 위치 이동 함수
                function updateSliderPosition() {
                    var offset = -itemWidth * visibleItems * currentSlide; // 슬라이드 위치 계산
                    $("#" + sliderId).css("transform", "translateX(" + offset + "px)");
                    updateButtons(); // 버튼 상태 업데이트
                }

                // 왼쪽 버튼 클릭
                $(prevBtn).off("click").on("click", function () {
                    if (currentSlide > 0) {
                        currentSlide--;
                        sliderStates[sliderId] = currentSlide; // 상태 저장
                        updateSliderPosition();
                    }
                });

                // 오른쪽 버튼 클릭
                $(nextBtn).off("click").on("click", function () {
                    if (currentSlide < slideCount - 1) {
                        currentSlide++;
                        sliderStates[sliderId] = currentSlide; // 상태 저장
                        updateSliderPosition();
                    }
                });

                // 슬라이드 갱신
                updateSliderPosition();
            }

            // 탭 전환 시 슬라이드 갱신
            $(document).on("shown.bs.tab", 'a[data-bs-toggle="tab"]', function (e) {
                if ($(e.target).attr("data-bs-target") === "#movie-chart") {
                    initSlider("movie-slider", "#movie-chart .prev-btn", "#movie-chart .next-btn");
                } else if ($(e.target).attr("data-bs-target") === "#upcome-chart") {
                    initSlider("upcome-slider", "#upcome-chart .prev-btn", "#upcome-chart .next-btn");
                }
            });

            initSlider("movie-slider", "#movie-chart .prev-btn", "#movie-chart .next-btn");
        });
    </script>
</body>
</html>